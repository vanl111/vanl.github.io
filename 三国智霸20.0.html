<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¸‰å›½æ™ºéœ¸</title>
    <style>
        body { 
            font-family: 'SimSun', serif; 
            background: url('https://img.freepik.com/free-vector/chinese-pattern-background_53876-90035.jpg') center/cover fixed; 
            margin: 0;
            padding: 0;
        }
        .game-container { 
            display: grid; 
            grid-template-columns: 1fr 2fr 1fr; 
            gap: 20px; 
            padding: 20px; 
            max-width: 1400px; 
            margin: 0 auto; 
            background-color: rgba(255,255,255,0.85); 
            border-radius: 15px; 
            border: 3px solid #8B4513; 
        }
        .panel { 
            background-color: rgba(255,248,220,0.9); 
            border-radius: 10px; 
            padding: 20px; 
            border: 2px solid #8B4513; 
        }
        .city-node { 
            position: absolute; 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background-color: #FFD700; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            border: 2px solid #8B0000; 
            font-size: 12px;
        }
        .city-node-owned { 
            background-color: #006400; 
            color: white; 
            border-color: #000; 
        }
        .action-button { 
            background-color: #8B4513; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
            display: block;
            width: 100%;
            box-sizing: border-box;
        }
        .character-selection { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.8); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            color: white;
        }
        .character-card { 
            background-color: rgba(255,248,220,0.95); 
            border-radius: 10px; 
            padding: 20px; 
            width: 250px; 
            text-align: center; 
            cursor: pointer; 
            border: 3px solid #8B4513; 
            transition: transform 0.3s; 
            color: black;
            margin: 10px;
        }
        .character-card:hover { 
            transform: scale(1.05); 
        }
        .character-card.disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
        }
        .cover-screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0,0,0,0.9); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 2000; 
            color: white; 
        }
        .cover-title { 
            font-size: 4rem; 
            color: #FFD700; 
            text-shadow: 3px 3px 5px #8B0000; 
            margin-bottom: 30px; 
            animation: pulse 2s infinite; 
        }
        .start-button { 
            background-color: #8B0000; 
            color: white; 
            padding: 15px 40px; 
            font-size: 1.5rem; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        .start-button:hover { 
            background-color: #FF0000; 
            transform: scale(1.1); 
        }
        .hint-box { 
            display: none; 
            background-color: rgba(70, 130, 180, 0.2); 
            padding: 10px; 
            border-radius: 5px; 
            margin-top: 10px; 
        }
        #map { 
            position: relative; 
            min-height: 500px; 
            background-image: url('https://img.freepik.com/free-vector/hand-painted-watercolor-pastel-sky-background_23-2148902771.jpg'); 
            background-size: cover; 
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .stats-table th, .stats-table td {
            border: 1px solid #8B4513;
            padding: 8px;
            text-align: left;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: rgba(255,248,220,0.95);
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid #8B4513;
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #8B4513;
        }
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background-color: rgba(255,248,220,0.9);
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #8B4513;
        }
        .event-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 4000;
            justify-content: center;
            align-items: center;
        }
        .event-content {
            background-color: rgba(255,248,220,0.95);
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 80%;
            text-align: center;
            border: 3px solid #8B4513;
        }
        .event-title {
            color: #8B0000;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        .event-message {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        .event-button {
            background-color: #8B4513;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <!-- æ·»åŠ éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control" id="musicControl" onclick="toggleMusic()">
        <span id="musicIcon">ğŸµ</span>
    </div>
    
    <!-- æ·»åŠ éŸ³é¢‘å…ƒç´  -->
    <audio id="bgMusic" loop>
        <source src="https://music.163.com/song/media/outer/url?id=5271858.mp3" type="audio/mpeg">
    </audio>

    <div class="cover-screen" id="coverScreen">
        <h1 class="cover-title">ä¸‰å›½æ™ºéœ¸</h1>
        <p style="font-size: 1.5rem; margin-bottom: 30px; max-width: 800px; text-align: center;">
            é€šè¿‡å›ç­”ä¸‰å›½å†å²é—®é¢˜æ¥æ”»åŸç•¥åœ°ï¼Œå é¢†æ‰€æœ‰10åº§åŸæ± å³å¯ç»Ÿä¸€å¤©ä¸‹ï¼<br>
            <span style="color: #FFD700;">æ–°å¢éšæœºäº‹ä»¶ç³»ç»Ÿï¼Œä½“éªŒæ›´ä¸°å¯Œçš„ä¸‰å›½äº‰éœ¸ï¼</span>
        </p>
        <button class="start-button" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <div class="character-selection" id="characterSelection" style="display: none;">
        <div style="background-color: rgba(255,248,220,0.9); padding: 20px; border-radius: 10px; max-width: 800px; margin-bottom: 30px; border: 3px solid #8B4513; color: black;">
            <h1 style="color: #8B0000; text-align: center; font-size: 2.5rem; margin-bottom: 15px;">é€‰æ‹©ä¸»å…¬</h1>
            <p id="selectionPrompt">æ¯ä½ä¸»å…¬æ‹¥æœ‰ä¸åŒçš„åˆå§‹èµ„æºï¼Œé€‰æ‹©ä¸€ä½å¼€å§‹ä½ çš„äº‰éœ¸ä¹‹è·¯ï¼</p>
        </div>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;">
            <div class="character-card" id="caoCaoCard" onclick="selectCharacter('æ›¹æ“')">
                <h2>æ›¹æ“</h2>
                <p>åˆå§‹èµ„é‡‘ï¼š6000ï¼Œç²®è‰ï¼š12000ï¼Œå…µåŠ›ï¼š3500</p>
                <p style="font-style: italic; color: #8B0000;">"å®æ•™æˆ‘è´Ÿå¤©ä¸‹äººï¼Œä¼‘æ•™å¤©ä¸‹äººè´Ÿæˆ‘"</p>
            </div>
            <div class="character-card" id="liuBeiCard" onclick="selectCharacter('åˆ˜å¤‡')">
                <h2>åˆ˜å¤‡</h2>
                <p>åˆå§‹èµ„é‡‘ï¼š5000ï¼Œç²®è‰ï¼š10000ï¼Œå…µåŠ›ï¼š3000</p>
                <p style="font-style: italic; color: #8B0000;">"å‹¿ä»¥æ¶å°è€Œä¸ºä¹‹ï¼Œå‹¿ä»¥å–„å°è€Œä¸ä¸º"</p>
            </div>
            <div class="character-card" id="sunQuanCard" onclick="selectCharacter('å­™æƒ')">
                <h2>å­™æƒ</h2>
                <p>åˆå§‹èµ„é‡‘ï¼š5500ï¼Œç²®è‰ï¼š11000ï¼Œå…µåŠ›ï¼š3200</p>
                <p style="font-style: italic; color: #8B0000;">"èƒ½ç”¨ä¼—åŠ›ï¼Œåˆ™æ— æ•Œäºå¤©ä¸‹çŸ£"</p>
            </div>
        </div>
    </div>
    
    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="panel">
            <h2>ğŸ¯ åŸæ± æ²»ç†</h2>
            <div style="background-color: rgba(255,255,255,0.9); border-radius: 5px; padding: 10px; margin-bottom: 10px; border: 1px solid #8B4513;">
                <div>ğŸ’° èµ„é‡‘ï¼š<span id="gold">0</span></div>
                <div>ğŸŒ¾ ç²®è‰ï¼š<span id="food">0</span></div>
                <div>âš”ï¸ å…µåŠ›ï¼š<span id="troops">0</span></div>
                <div>ğŸ° å·²å é¢†ï¼š<span id="citiesCount">0</span>/10</div>
                <div>âœ… ç­”å¯¹ï¼š<span id="correctCount">0</span> âŒ ç­”é”™ï¼š<span id="wrongCount">0</span></div>
            </div>
            <button class="action-button" onclick="game.militaryReform()">å†›äº‹æ”¹é© (æ¶ˆè€—2000é‡‘)</button>
            <button class="action-button" onclick="game.agriculturalDevelopment()">å†œä¸šå‘å±• (æ¶ˆè€—1500é‡‘)</button>
            <button class="action-button" onclick="game.showHint()" style="background-color: #4682B4;">æç¤º</button>
            <button class="action-button" onclick="game.openShop()" style="background-color: #8B008B;">å•†åŸ</button>
            <button class="action-button" onclick="game.showStats()" style="background-color: #556B2F;">ç­”é¢˜ç»Ÿè®¡</button>
            <button class="action-button" onclick="game.returnToCharacterSelection()" style="background-color: #8B0000; margin-top: 20px;">è¿”å›é€‰è§’</button>
        </div>
        
        <div class="panel" id="map"></div>
        
        <div class="panel">
            <h2>âš”ï¸ æ”»åŸç•¥åœ°</h2>
            <div id="questionBox" style="background-color: rgba(255,255,255,0.9); border-radius: 5px; padding: 15px; margin-bottom: 10px; border: 1px solid #8B4513;">
                <p>ç‚¹å‡»åœ°å›¾ä¸Šçš„åŸæ± å¼€å§‹æ”»åŸï¼</p>
            </div>
            <div id="progressBox" style="display: none;">
                <p>æ”»åŸè¿›åº¦: <span id="correctAnswers">0</span>/<span id="requiredAnswers">2</span></p>
            </div>
            <div id="hintBox" class="hint-box">
                <h3>ğŸ’¡ æç¤º</h3>
                <p id="hintText"></p>
            </div>
        </div>
    </div>

    <!-- å•†åŸæ¨¡æ€æ¡† -->
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <span class="close-button" onclick="game.closeShop()">&times;</span>
            <h2 style="color: #8B0000; text-align: center; margin-bottom: 20px;">å•†åŸ</h2>
            <div class="panel">
                <div class="shop-item">
                    <div>
                        <h3>å…µåŠ›è¡¥å……åŒ…</h3>
                        <p>ç«‹å³å¢åŠ 1000å…µåŠ›</p>
                    </div>
                    <button class="action-button" onclick="game.buyItem('troops')">è´­ä¹° (3000é‡‘)</button>
                </div>
                <div class="shop-item">
                    <div>
                        <h3>ç²®è‰è¡¥å……åŒ…</h3>
                        <p>ç«‹å³å¢åŠ 5000ç²®è‰</p>
                    </div>
                    <button class="action-button" onclick="game.buyItem('food')">è´­ä¹° (2000é‡‘)</button>
                </div>
                <div class="shop-item">
                    <div>
                        <h3>å…ç­”å¡</h3>
                        <p>æ”»åŸæ—¶å¯å…ç­”ä¸€é¢˜</p>
                    </div>
                    <button class="action-button" onclick="game.buyItem('freeAnswer')">è´­ä¹° (2500é‡‘)</button>
                </div>
                <div class="shop-item">
                    <div>
                        <h3>åŒå€å¥–åŠ±å¡</h3>
                        <p>ä¸‹æ¬¡æ”»åŸæˆåŠŸè·å¾—åŒå€å¥–åŠ±</p>
                    </div>
                    <button class="action-button" onclick="game.buyItem('doubleReward')">è´­ä¹° (4000é‡‘)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç­”é¢˜ç»Ÿè®¡æ¨¡æ€æ¡† -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <span class="close-button" onclick="game.closeStats()">&times;</span>
            <h2 style="color: #8B0000; text-align: center; margin-bottom: 20px;">ç­”é¢˜ç»Ÿè®¡</h2>
            <div class="panel">
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>é¢˜ç›®</th>
                            <th>ä½ çš„ç­”æ¡ˆ</th>
                            <th>æ­£ç¡®ç­”æ¡ˆ</th>
                            <th>ç»“æœ</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody">
                        <!-- ç­”é¢˜è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
                <div style="margin-top: 20px; font-weight: bold;">
                    <p>æ€»ç­”é¢˜æ•°: <span id="totalQuestions">0</span></p>
                    <p>æ­£ç¡®ç‡: <span id="accuracyRate">0</span>%</p>
                    <p>è¿ç»­ç­”å¯¹æœ€é«˜è®°å½•: <span id="maxStreak">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- éšæœºäº‹ä»¶æ¨¡æ€æ¡† -->
    <div class="event-modal" id="eventModal">
        <div class="event-content">
            <h2 class="event-title" id="eventTitle">éšæœºäº‹ä»¶</h2>
            <p class="event-message" id="eventMessage"></p>
            <button class="event-button" onclick="game.closeEvent()">ç¡®å®š</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡ï¼Œè®°å½•å·²é€‰è§’è‰²
        const selectedCharacters = new Set();
        
        // é—®é¢˜åº“é…ç½®
        const QUESTIONS = [
            { 
                q: "å®˜æ¸¡ä¹‹æˆ˜çš„ä¸»è¦äº¤æˆ˜åŒæ–¹æ˜¯ï¼Ÿ", 
                o: ["æ›¹æ“vsè¢ç»", "åˆ˜å¤‡vså­™æƒ", "æ›¹æ“vsåˆ˜å¤‡"], 
                a: 0,
                hint: "è¿™åœºæˆ˜å½¹å‘ç”Ÿåœ¨å…¬å…ƒ200å¹´ï¼Œæ˜¯åŒ—æ–¹ä¸¤å¤§åŠ¿åŠ›çš„å†³æˆ˜ã€‚"
            },
            { 
                q: "è¯¸è‘›äº®çš„å­—æ˜¯ä»€ä¹ˆï¼Ÿ", 
                o: ["å­”æ˜", "ä»²è¾¾", "å…¬ç‘¾"], 
                a: 0,
                hint: "ä»–çš„å­—ä¸'å§é¾™'çš„ç§°å·ç›¸å‘¼åº”ï¼Œæ„ä¸º'æ˜äº®çš„å­”æ´'ã€‚"
            },
            { 
                q: "æ¡ƒå›­ä¸‰ç»“ä¹‰çš„ä¸‰ä¸ªäººæ˜¯ï¼Ÿ", 
                o: ["åˆ˜å¤‡ã€å…³ç¾½ã€å¼ é£", "æ›¹æ“ã€å­™æƒã€åˆ˜å¤‡", "å•å¸ƒã€è²‚è‰ã€è‘£å“"], 
                a: 0,
                hint: "è¿™ä¸‰äººåœ¨æ¡ƒå›­ç»“ä¸ºå¼‚å§“å…„å¼Ÿï¼Œèª“åŒç”Ÿæ­»ã€‚"
            },
            { 
                q: "èµ¤å£ä¹‹æˆ˜å‘ç”Ÿåœ¨å“ªä¸ªæ±Ÿï¼Ÿ", 
                o: ["é•¿æ±Ÿ", "é»„æ²³", "æ·®æ²³"], 
                a: 0,
                hint: "è¿™æ˜¯ä¸­å›½æœ€é•¿çš„æ²³æµï¼Œä¹Ÿæ˜¯å—åŒ—åˆ†ç•Œçº¿ã€‚"
            },
            { 
                q: "å­™æƒæ˜¯å“ªä¸ªå›½å®¶çš„ä¸»å…¬ï¼Ÿ", 
                o: ["å´å›½", "é­å›½", "èœ€å›½"], 
                a: 0,
                hint: "è¿™ä¸ªå›½å®¶ä½äºä¸œå—æ²¿æµ·ï¼Œä»¥æ°´å†›è‘—ç§°ã€‚"
            },
            { 
                q: "è¢«ç§°ä¸ºå°éœ¸ç‹çš„æ˜¯è°ï¼Ÿ", 
                o: ["å­™ç­–", "å­™åš", "å‘¨ç‘œ"], 
                a: 0,
                hint: "ä»–æ˜¯å­™æƒçš„å…„é•¿ï¼Œå‹‡çŒ›å–„æˆ˜ï¼Œå¥ å®šäº†å´å›½çš„åŸºç¡€ã€‚"
            },
            { 
                q: "å…³ç¾½è¿‡äº”å…³æ–©çš„ç¬¬ä¸€å°†æ˜¯è°ï¼Ÿ", 
                o: ["å­”ç§€", "éŸ©ç¦", "å­Ÿå¦"], 
                a: 0,
                hint: "è¿™ä½å°†é¢†é•‡å®ˆä¸œå²­å…³ï¼Œæ˜¯å…³ç¾½åŒ—ä¸Šçš„ç¬¬ä¸€é“å…³å¡ã€‚"
            },
            { 
                q: "ä»¥ä¸‹è°æ˜¯åˆ˜ç¦…çš„ä¹³åï¼Ÿ", 
                o: ["é˜¿æ–—", "ä¼¯çº¦", "å¥‰å­"], 
                a: 0,
                hint: "è¿™ä¸ªä¹³åå› 'æ‰¶ä¸èµ·çš„...'è€Œé—»åã€‚"
            },
            { 
                q: "å“ªä¸ªå›½å®¶æ˜¯ç”±æ›¹ä¸•å»ºç«‹çš„ï¼Ÿ", 
                o: ["é­å›½", "èœ€å›½", "å´å›½"], 
                a: 0,
                hint: "è¿™ä¸ªå›½å®¶ä½äºåŒ—æ–¹ï¼Œä»¥æ´›é˜³ä¸ºéƒ½åŸã€‚"
            },
            { 
                q: "åˆ˜å¤‡ä¸‰é¡¾èŒ…åºè¯·çš„æ˜¯è°ï¼Ÿ", 
                o: ["è¯¸è‘›äº®", "åºç»Ÿ", "å¾åº¶"], 
                a: 0,
                hint: "è¿™ä½è°‹å£«åæ¥æˆä¸ºèœ€æ±‰çš„ä¸ç›¸ï¼Œè¢«èª‰ä¸º'å§é¾™'ã€‚"
            }
        ];

        // åŸæ± é…ç½® - æ·»åŠ äº†å…µåŠ›å±æ€§
        const CITIES = [
            { name: 'æ´›é˜³', x: 30, y: 40, defender: 'è‘£å“', troops: 4000 },
            { name: 'æˆéƒ½', x: 15, y: 70, defender: 'åˆ˜ç’‹', troops: 3500 },
            { name: 'è®¸æ˜Œ', x: 35, y: 30, defender: 'å¼ æµ', troops: 3800 },
            { name: 'å»ºä¸š', x: 65, y: 20, defender: 'åˆ˜ç¹‡', troops: 3700 },
            { name: 'é•¿å®‰', x: 20, y: 50, defender: 'æå‚•', troops: 4200 },
            { name: 'è†å·', x: 45, y: 55, defender: 'åˆ˜è¡¨', troops: 3600 },
            { name: 'å¾å·', x: 55, y: 35, defender: 'é™¶è°¦', troops: 3400 },
            { name: 'è¥„é˜³', x: 40, y: 60, defender: 'è”¡ç‘', troops: 3900 },
            { name: 'å®›åŸ', x: 32, y: 52, defender: 'å¼ ç»£', troops: 3300 },
            { name: 'å—éƒ¡', x: 42, y: 65, defender: 'æ›¹ä»', troops: 4100 }
        ];

        // éšæœºäº‹ä»¶é…ç½®
        const RANDOM_EVENTS = [
            // æ­£é¢äº‹ä»¶
            {
                title: "ä¸°æ”¶ä¹‹å¹´",
                message: "ä»Šå¹´é£è°ƒé›¨é¡ºï¼Œå†œç”°å¤§ä¸°æ”¶ï¼",
                effect: (game) => {
                    const bonus = Math.floor(Math.random() * 3000) + 2000;
                    game.state.food += bonus;
                    return `è·å¾—${bonus}ç²®è‰ï¼`;
                },
                probability: 0.15
            },
            {
                title: "å‘ç°å®è—",
                message: "åœ¨ä½ çš„é¢†åœ°å†…å‘ç°äº†ä¸€å¤„éšè—çš„å®è—ï¼",
                effect: (game) => {
                    const bonus = Math.floor(Math.random() * 2000) + 1000;
                    game.state.gold += bonus;
                    return `è·å¾—${bonus}é‡‘ï¼`;
                },
                probability: 0.1
            },
            {
                title: "åå°†æ¥æŠ•",
                message: "ä¸€ä½è‘—åå°†é¢†ä»°æ…•ä½ çš„å¨åï¼Œç‡éƒ¨æ¥æŠ•ï¼",
                effect: (game) => {
                    const bonus = Math.floor(Math.random() * 800) + 500;
                    game.state.troops += bonus;
                    return `è·å¾—${bonus}å…µåŠ›ï¼`;
                },
                probability: 0.1
            },
            {
                title: "å•†é˜Ÿè´¸æ˜“",
                message: "ä¸€æ”¯å¤§å‹å•†é˜Ÿæ¥åˆ°ä½ çš„åŸæ± è¿›è¡Œè´¸æ˜“ï¼Œå¸¦æ¥äº†ä¸°åšåˆ©æ¶¦ï¼",
                effect: (game) => {
                    const goldBonus = Math.floor(Math.random() * 1500) + 1000;
                    const foodBonus = Math.floor(Math.random() * 2000) + 1000;
                    game.state.gold += goldBonus;
                    game.state.food += foodBonus;
                    return `è·å¾—${goldBonus}é‡‘å’Œ${foodBonus}ç²®è‰ï¼`;
                },
                probability: 0.1
            },
            {
                title: "æ°‘å¿ƒæ‰€å‘",
                message: "ä½ çš„ä»æ”¿æ·±å¾—æ°‘å¿ƒï¼Œç™¾å§“è¸Šè·ƒå‚å†›ï¼",
                effect: (game) => {
                    const troopsBonus = Math.floor(Math.random() * 1000) + 500;
                    game.state.troops += troopsBonus;
                    return `è·å¾—${troopsBonus}å…µåŠ›ï¼`;
                },
                probability: 0.08
            },
            // è´Ÿé¢äº‹ä»¶
            {
                title: "è—ç¾è‚†è™",
                message: "å¯æ€•çš„è—ç¾å¸­å·äº†ä½ çš„é¢†åœ°ï¼",
                effect: (game) => {
                    const loss = Math.floor(Math.random() * 3000) + 2000;
                    game.state.food = Math.max(0, game.state.food - loss);
                    return `æŸå¤±${loss}ç²®è‰ï¼`;
                },
                probability: 0.1
            },
            {
                title: "æ•Œå†›å·è¢­",
                message: "æ•Œå†›è¶å¤œå·è¢­äº†ä½ çš„è¥åœ°ï¼",
                effect: (game) => {
                    const loss = Math.floor(Math.random() * 800) + 500;
                    game.state.troops = Math.max(0, game.state.troops - loss);
                    return `æŸå¤±${loss}å…µåŠ›ï¼`;
                },
                probability: 0.1
            },
            {
                title: "å›½åº“å¤±çªƒ",
                message: "æœ‰ç›—è´¼æ½œå…¥å›½åº“ï¼Œå·èµ°äº†å¤§é‡é’±è´¢ï¼",
                effect: (game) => {
                    const loss = Math.floor(Math.random() * 2000) + 1000;
                    game.state.gold = Math.max(0, game.state.gold - loss);
                    return `æŸå¤±${loss}é‡‘ï¼`;
                },
                probability: 0.08
            },
            {
                title: "ç˜Ÿç–«æµè¡Œ",
                message: "é¢†åœ°å†…çˆ†å‘ç˜Ÿç–«ï¼Œå†›æ°‘å£«æ°”ä½è½ï¼",
                effect: (game) => {
                    const troopsLoss = Math.floor(Math.random() * 1000) + 500;
                    const foodLoss = Math.floor(Math.random() * 2000) + 1000;
                    game.state.troops = Math.max(0, game.state.troops - troopsLoss);
                    game.state.food = Math.max(0, game.state.food - foodLoss);
                    return `æŸå¤±${troopsLoss}å…µåŠ›å’Œ${foodLoss}ç²®è‰ï¼`;
                },
                probability: 0.07
            },
            {
                title: "å¹²æ—±ç¼ºæ°´",
                message: "æŒç»­å¹²æ—±å¯¼è‡´å†œç”°æ­‰æ”¶ï¼Œæ°´æºçŸ­ç¼ºï¼",
                effect: (game) => {
                    const loss = Math.floor(Math.random() * 4000) + 2000;
                    game.state.food = Math.max(0, game.state.food - loss);
                    return `æŸå¤±${loss}ç²®è‰ï¼`;
                },
                probability: 0.07
            },
            // ä¸­æ€§äº‹ä»¶
            {
                title: "ç¥ç§˜å•†äºº",
                message: "ä¸€ä½ç¥ç§˜å•†äººæ¥åˆ°ä½ çš„åŸæ± ï¼Œæ„¿æ„ä»¥ä¼˜æƒ ä»·æ ¼å‡ºå”®å•†å“ï¼",
                effect: (game) => {
                    // éšæœºé€‰æ‹©ä¸€ç§å•†å“æ‰“æŠ˜å‡ºå”®
                    const items = ['troops', 'food', 'freeAnswer', 'doubleReward'];
                    const item = items[Math.floor(Math.random() * items.length)];
                    const discount = Math.floor(Math.random() * 30) + 20; // 20-50%æŠ˜æ‰£
                    
                    let cost = 0;
                    let bonus = 0;
                    let itemName = '';
                    
                    switch(item) {
                        case 'troops':
                            cost = Math.floor(3000 * (100 - discount) / 100);
                            bonus = 1000;
                            itemName = 'å…µåŠ›è¡¥å……åŒ…';
                            break;
                        case 'food':
                            cost = Math.floor(2000 * (100 - discount) / 100);
                            bonus = 5000;
                            itemName = 'ç²®è‰è¡¥å……åŒ…';
                            break;
                        case 'freeAnswer':
                            cost = Math.floor(2500 * (100 - discount) / 100);
                            bonus = 1;
                            itemName = 'å…ç­”å¡';
                            break;
                        case 'doubleReward':
                            cost = Math.floor(4000 * (100 - discount) / 100);
                            bonus = 1;
                            itemName = 'åŒå€å¥–åŠ±å¡';
                            break;
                    }
                    
                    const buy = confirm(`ç¥ç§˜å•†äººæ„¿æ„ä»¥${discount}%æŠ˜æ‰£å‡ºå”®${itemName}ï¼Œåªéœ€${cost}é‡‘ã€‚æ˜¯å¦è´­ä¹°ï¼Ÿ`);
                    if (buy && game.state.gold >= cost) {
                        game.state.gold -= cost;
                        if (item === 'troops') game.state.troops += bonus;
                        else if (item === 'food') game.state.food += bonus;
                        else game.state.items[item] += bonus;
                        game.updateDisplay();
                        return `ä½ è´­ä¹°äº†${itemName}ï¼`;
                    } else if (buy) {
                        return `èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•è´­ä¹°${itemName}ã€‚`;
                    } else {
                        return `ä½ æ‹’ç»äº†ç¥ç§˜å•†äººçš„æè®®ã€‚`;
                    }
                },
                probability: 0.05
            },
            {
                title: "å¤©é™å¼‚è±¡",
                message: "å¤©ç©ºå‡ºç°å¥‡å¼‚å¤©è±¡ï¼Œç™¾å§“è®®è®ºçº·çº·ï¼",
                effect: (game) => {
                    // 50%å‡ ç‡æ­£é¢æ•ˆæœï¼Œ50%è´Ÿé¢æ•ˆæœ
                    if (Math.random() > 0.5) {
                        const bonus = Math.floor(Math.random() * 1000) + 500;
                        game.state.troops += bonus;
                        return `å£«å…µä»¬è®¤ä¸ºè¿™æ˜¯å‰å…†ï¼Œå£«æ°”å¤§æŒ¯ï¼è·å¾—${bonus}å…µåŠ›ï¼`;
                    } else {
                        const loss = Math.floor(Math.random() * 1000) + 500;
                        game.state.troops = Math.max(0, game.state.troops - loss);
                        return `å£«å…µä»¬è®¤ä¸ºè¿™æ˜¯å‡¶å…†ï¼Œå£«æ°”ä½è½ï¼æŸå¤±${loss}å…µåŠ›ï¼`;
                    }
                },
                probability: 0.05
            }
        ];

        // éŸ³ä¹æ§åˆ¶å‡½æ•°
        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            const icon = document.getElementById('musicIcon');
            
            if (music.paused) {
                music.play();
                icon.textContent = 'ğŸ”Š';
            } else {
                music.pause();
                icon.textContent = 'ğŸ”‡';
            }
        }

        class ThreeKingdomsGame {
            constructor(character) {
                this.character = character;
                this.state = {
                    gold: character === 'æ›¹æ“' ? 6000 : character === 'åˆ˜å¤‡' ? 5000 : 5500,
                    food: character === 'æ›¹æ“' ? 12000 : character === 'åˆ˜å¤‡' ? 10000 : 11000,
                    troops: character === 'æ›¹æ“' ? 3500 : character === 'åˆ˜å¤‡' ? 3000 : 3200,
                    cities: [],
                    items: {
                        freeAnswer: 0,
                        doubleReward: 0
                    }
                };
                this.currentCity = null;
                this.correctAnswers = 0;
                this.requiredAnswers = 2; // é»˜è®¤éœ€è¦ç­”å¯¹2é¢˜
                this.currentQuestion = null;
                this.stats = {
                    correct: 0,
                    wrong: 0,
                    history: [],
                    currentStreak: 0,
                    maxStreak: 0
                };
                this.lastEventTime = 0;
                this.initMap();
                this.updateDisplay();
                
                // è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                document.getElementById('bgMusic').volume = 0.3;
                document.getElementById('bgMusic').play();
                document.getElementById('musicIcon').textContent = 'ğŸ”Š';
                
                // è®¾ç½®éšæœºäº‹ä»¶æ£€æŸ¥å®šæ—¶å™¨
                this.eventCheckInterval = setInterval(() => this.checkForRandomEvent(), 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
            }

            // æ£€æŸ¥æ˜¯å¦è§¦å‘éšæœºäº‹ä»¶
            checkForRandomEvent() {
                const now = Date.now();
                // è‡³å°‘5åˆ†é’Ÿæ‰ä¼šè§¦å‘ä¸€æ¬¡äº‹ä»¶
                if (now - this.lastEventTime < 300000) return;
                
                // è®¡ç®—æ€»æ¦‚ç‡
                const totalProbability = RANDOM_EVENTS.reduce((sum, event) => sum + event.probability, 0);
                const roll = Math.random() * totalProbability;
                
                let cumulativeProbability = 0;
                for (const event of RANDOM_EVENTS) {
                    cumulativeProbability += event.probability;
                    if (roll <= cumulativeProbability) {
                        this.triggerEvent(event);
                        this.lastEventTime = now;
                        break;
                    }
                }
            }

            // è§¦å‘éšæœºäº‹ä»¶
            triggerEvent(event) {
                const result = event.effect(this);
                
                document.getElementById('eventTitle').textContent = event.title;
                document.getElementById('eventMessage').textContent = `${event.message} ${result}`;
                document.getElementById('eventModal').style.display = 'flex';
                
                this.updateDisplay();
            }

            // å…³é—­äº‹ä»¶çª—å£
            closeEvent() {
                document.getElementById('eventModal').style.display = 'none';
            }

            // æ‰“ä¹±é—®é¢˜é€‰é¡¹é¡ºåº
            shuffleQuestion(question) {
                const options = [...question.o];
                const correctAnswer = options[question.a];
                
                // éšæœºæ‰“ä¹±é€‰é¡¹
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                return {
                    q: question.q,
                    o: options,
                    a: options.indexOf(correctAnswer),
                    hint: question.hint
                };
            }

            initMap() {
                const map = document.getElementById('map');
                map.innerHTML = '';
                CITIES.forEach(city => {
                    const node = document.createElement('div');
                    node.className = 'city-node';
                    node.style.left = `${city.x}%`;
                    node.style.top = `${city.y}%`;
                    node.textContent = city.name;
                    node.title = `${city.name} (${city.defender}é©»å®ˆ, å…µåŠ›: ${city.troops})`;
                    node.onclick = () => this.attackCity(city);
                    if (this.state.cities.includes(city.name)) {
                        node.classList.add('city-node-owned');
                    }
                    map.appendChild(node);
                });
            }

            attackCity(city) {
                if (this.state.cities.includes(city.name)) {
                    alert('è¯¥åœ°ç›˜å·²å é¢†');
                    return;
                }
                if (this.state.troops <= 0) {
                    alert('å…µåŠ›ä¸è¶³ï¼');
                    return;
                }
                if (this.state.food < 5000) {
                    alert('ç²®è‰ä¸è¶³ï¼æ¯æ¬¡æ”»åŸéœ€è¦5000ç²®è‰');
                    return;
                }
                
                // æ ¹æ®æ•Œæ–¹å…µåŠ›è°ƒæ•´éœ€è¦ç­”å¯¹çš„é¢˜ç›®æ•°é‡
                if (city.troops > this.state.troops) {
                    this.requiredAnswers = 3;
                    alert(`è­¦å‘Šï¼${city.defender}é©»å®ˆçš„${city.name}å…µåŠ›(${city.troops})è¶…è¿‡ä½ çš„å…µåŠ›(${this.state.troops})ï¼Œéœ€è¦ç­”å¯¹3é¢˜æ‰èƒ½æ”»ä¸‹ï¼`);
                } else {
                    this.requiredAnswers = 2;
                }
                
                // æ¶ˆè€—ç²®è‰
                this.state.food -= 5000;
                this.updateDisplay();
                
                this.currentCity = city;
                this.correctAnswers = 0;
                document.getElementById('progressBox').style.display = 'block';
                document.getElementById('correctAnswers').textContent = this.correctAnswers;
                document.getElementById('requiredAnswers').textContent = this.requiredAnswers;
                document.getElementById('hintBox').style.display = 'none';
                
                this.showQuestion();
            }

            showQuestion() {
                const originalQuestion = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
                const question = this.shuffleQuestion(originalQuestion);
                
                this.currentQuestion = question;
                const box = document.getElementById('questionBox');
                box.innerHTML = `
                    <h3>æ”»æ‰“ ${this.currentCity.defender} é©»å®ˆçš„ ${this.currentCity.name} (æ¶ˆè€—5000ç²®è‰)</h3>
                    <p>${question.q}</p>
                    ${question.o.map((opt, i) => `
                        <button class="action-button" onclick="game.answer(${i}, ${question.a})">${opt}</button>
                    `).join('')}
                    ${this.state.items.freeAnswer > 0 ? 
                        `<button class="action-button" onclick="game.useFreeAnswer()" style="background-color: #4CAF50;">ä½¿ç”¨å…ç­”å¡ (å‰©ä½™${this.state.items.freeAnswer})</button>` : ''}
                `;
            }

            showHint() {
                if (!this.currentQuestion) {
                    alert('è¯·åœ¨æ”»åŸæ—¶ä½¿ç”¨æç¤ºï¼');
                    return;
                }
                
                document.getElementById('hintBox').style.display = 'block';
                document.getElementById('hintText').textContent = this.currentQuestion.hint;
            }

            answer(selected, correct) {
                const isCorrect = selected === correct;
                const selectedAnswer = this.currentQuestion.o[selected];
                const correctAnswer = this.currentQuestion.o[correct];
                
                // è®°å½•ç­”é¢˜å†å²
                this.stats.history.push({
                    question: this.currentQuestion.q,
                    selected: selectedAnswer,
                    correct: correctAnswer,
                    isCorrect: isCorrect
                });
                
                if (isCorrect) {
                    this.correctAnswers++;
                    this.stats.correct++;
                    this.stats.currentStreak++;
                    if (this.stats.currentStreak > this.stats.maxStreak) {
                        this.stats.maxStreak = this.stats.currentStreak;
                    }
                    document.getElementById('correctAnswers').textContent = this.correctAnswers;
                    document.getElementById('correctCount').textContent = this.stats.correct;
                    
                    if (this.correctAnswers >= this.requiredAnswers) {
                        let goldReward = 1000;
                        let troopsReward = 300;
                        
                        // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨åŒå€å¥–åŠ±å¡
                        if (this.state.items.doubleReward > 0) {
                            goldReward *= 2;
                            troopsReward *= 2;
                            this.state.items.doubleReward--;
                            alert('åŒå€å¥–åŠ±å¡ç”Ÿæ•ˆï¼è·å¾—åŒå€å¥–åŠ±');
                        }
                        
                        this.state.gold += goldReward;
                        this.state.troops += troopsReward;
                        this.state.cities.push(this.currentCity.name);
                        alert(`æ”»å  ${this.currentCity.name} æˆåŠŸï¼è·å¾—${goldReward}é‡‘å’Œ${troopsReward}å…µåŠ›`);
                        this.resetAttack();
                        
                        if (this.state.cities.length === CITIES.length) {
                            setTimeout(() => {
                                alert(`æ­å–œä¸»å…¬ ${this.character} ç»Ÿä¸€å¤©ä¸‹ï¼`);
                                clearInterval(this.eventCheckInterval); // æ¸¸æˆç»“æŸåœæ­¢æ£€æŸ¥äº‹ä»¶
                            }, 500);
                        }
                    } else {
                        this.showQuestion();
                    }
                } else {
                    this.state.troops -= 500;
                    this.stats.wrong++;
                    this.stats.currentStreak = 0;
                    document.getElementById('wrongCount').textContent = this.stats.wrong;
                    alert(`å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer}\næŸå¤±500å…µåŠ›`);
                    this.resetAttack();
                }
                this.updateDisplay();
                this.initMap();
            }

            useFreeAnswer() {
                if (this.state.items.freeAnswer <= 0) return;
                
                this.state.items.freeAnswer--;
                this.correctAnswers++;
                document.getElementById('correctAnswers').textContent = this.correctAnswers;
                alert('ä½¿ç”¨å…ç­”å¡æˆåŠŸï¼è‡ªåŠ¨ç­”å¯¹ä¸€é¢˜');
                
                if (this.correctAnswers >= this.requiredAnswers) {
                    this.state.gold += 1000;
                    this.state.troops += 300;
                    this.state.cities.push(this.currentCity.name);
                    alert(`æ”»å  ${this.currentCity.name} æˆåŠŸï¼`);
                    this.resetAttack();
                    
                    if (this.state.cities.length === CITIES.length) {
                        setTimeout(() => {
                            alert(`æ­å–œä¸»å…¬ ${this.character} ç»Ÿä¸€å¤©ä¸‹ï¼`);
                            clearInterval(this.eventCheckInterval); // æ¸¸æˆç»“æŸåœæ­¢æ£€æŸ¥äº‹ä»¶
                        }, 500);
                    }
                } else {
                    this.showQuestion();
                }
                
                this.updateDisplay();
                this.initMap();
            }

            resetAttack() {
                this.currentCity = null;
                this.currentQuestion = null;
                this.correctAnswers = 0;
                this.requiredAnswers = 2;
                document.getElementById('questionBox').innerHTML = '<p>ç‚¹å‡»åœ°å›¾ä¸Šçš„åŸæ± å¼€å§‹æ”»åŸï¼</p>';
                document.getElementById('progressBox').style.display = 'none';
                document.getElementById('hintBox').style.display = 'none';
            }

            militaryReform() {
                if (this.state.gold >= 2000) {
                    this.state.gold -= 2000;
                    this.state.troops = Math.floor(this.state.troops * 1.2);
                    this.updateDisplay();
                    alert('å†›äº‹æ”¹é©æˆåŠŸï¼å…µåŠ›å¢åŠ 20%');
                } else {
                    alert('èµ„é‡‘ä¸è¶³ï¼');
                }
            }

            agriculturalDevelopment() {
                if (this.state.gold >= 1500) {
                    this.state.gold -= 1500;
                    this.state.food += 5000;
                    this.updateDisplay();
                    alert('å†œä¸šå‘å±•æˆåŠŸï¼ç²®è‰å¢åŠ 5000');
                } else {
                    alert('èµ„é‡‘ä¸è¶³ï¼');
                }
            }

            openShop() {
                document.getElementById('shopModal').style.display = 'flex';
            }

            closeShop() {
                document.getElementById('shopModal').style.display = 'none';
            }

            buyItem(type) {
                let cost = 0;
                let success = false;
                
                switch(type) {
                    case 'troops':
                        cost = 3000;
                        if (this.state.gold >= cost) {
                            this.state.gold -= cost;
                            this.state.troops += 1000;
                            success = true;
                            alert('è´­ä¹°æˆåŠŸï¼å…µåŠ›å¢åŠ 1000');
                        }
                        break;
                    case 'food':
                        cost = 2000;
                        if (this.state.gold >= cost) {
                            this.state.gold -= cost;
                            this.state.food += 5000;
                            success = true;
                            alert('è´­ä¹°æˆåŠŸï¼ç²®è‰å¢åŠ 5000');
                        }
                        break;
                    case 'freeAnswer':
                        cost = 2500;
                        if (this.state.gold >= cost) {
                            this.state.gold -= cost;
                            this.state.items.freeAnswer++;
                            success = true;
                            alert('è´­ä¹°æˆåŠŸï¼è·å¾—1å¼ å…ç­”å¡');
                        }
                        break;
                    case 'doubleReward':
                        cost = 4000;
                        if (this.state.gold >= cost) {
                            this.state.gold -= cost;
                            this.state.items.doubleReward++;
                            success = true;
                            alert('è´­ä¹°æˆåŠŸï¼è·å¾—1å¼ åŒå€å¥–åŠ±å¡');
                        }
                        break;
                }
                
                if (success) {
                    this.updateDisplay();
                } else {
                    alert('èµ„é‡‘ä¸è¶³ï¼');
                }
            }

            showStats() {
                const tableBody = document.getElementById('statsTableBody');
                tableBody.innerHTML = '';
                
                this.stats.history.forEach((record, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.question}</td>
                        <td>${record.selected}</td>
                        <td>${record.correct}</td>
                        <td style="color: ${record.isCorrect ? 'green' : 'red'}">${record.isCorrect ? 'âœ…' : 'âŒ'}</td>
                    `;
                    tableBody.appendChild(row);
                });
                
                const total = this.stats.correct + this.stats.wrong;
                const accuracy = total > 0 ? Math.round((this.stats.correct / total) * 100) : 0;
                
                document.getElementById('totalQuestions').textContent = total;
                document.getElementById('accuracyRate').textContent = accuracy;
                document.getElementById('maxStreak').textContent = this.stats.maxStreak;
                
                document.getElementById('statsModal').style.display = 'flex';
            }

            closeStats() {
                document.getElementById('statsModal').style.display = 'none';
            }

            returnToCharacterSelection() {
                // æ ‡è®°å½“å‰è§’è‰²ä¸ºå·²é€‰
                selectedCharacters.add(this.character);
                
                // éšè—æ¸¸æˆç•Œé¢
                document.getElementById('gameContainer').style.display = 'none';
                
                // æ˜¾ç¤ºè§’è‰²é€‰æ‹©ç•Œé¢
                document.getElementById('characterSelection').style.display = 'flex';
                
                // æ›´æ–°è§’è‰²é€‰æ‹©æç¤º
                const prompt = document.getElementById('selectionPrompt');
                prompt.textContent = selectedCharacters.size === 3 ? 
                    'æ‰€æœ‰è§’è‰²éƒ½å·²é€‰æ‹©è¿‡ï¼æ¸¸æˆå°†é‡æ–°å¼€å§‹' : 
                    'è¯·é€‰æ‹©ä¸€ä½ä¸»å…¬å¼€å§‹æ¸¸æˆ';
                
                // ç¦ç”¨å·²é€‰è§’è‰²
                document.querySelectorAll('.character-card').forEach(card => {
                    const character = card.id.replace('Card', '');
                    if (selectedCharacters.has(character)) {
                        card.classList.add('disabled');
                        card.onclick = null;
                    }
                });
                
                // åœæ­¢äº‹ä»¶æ£€æŸ¥
                clearInterval(this.eventCheckInterval);
                
                // å¦‚æœæ‰€æœ‰è§’è‰²éƒ½å·²é€‰æ‹©è¿‡ï¼Œæ¸…ç©ºè®°å½•
                if (selectedCharacters.size === 3) {
                    setTimeout(() => {
                        selectedCharacters.clear();
                        document.querySelectorAll('.character-card').forEach(card => {
                            card.classList.remove('disabled');
                            const character = card.id.replace('Card', '');
                            card.onclick = () => selectCharacter(character);
                        });
                        prompt.textContent = 'è¯·é€‰æ‹©ä¸€ä½ä¸»å…¬å¼€å§‹æ¸¸æˆ';
                    }, 3000);
                }
            }

            updateDisplay() {
                document.getElementById('gold').textContent = this.state.gold;
                document.getElementById('food').textContent = this.state.food;
                document.getElementById('troops').textContent = this.state.troops;
                document.getElementById('citiesCount').textContent = this.state.cities.length;
                document.getElementById('correctCount').textContent = this.stats.correct;
                document.getElementById('wrongCount').textContent = this.stats.wrong;
            }
        }

        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game;

        function startGame() {
            document.getElementById('coverScreen').style.display = 'none';
            document.getElementById('characterSelection').style.display = 'flex';
        }

        function selectCharacter(character) {
            if (selectedCharacters.has(character)) {
                alert('è¯¥è§’è‰²å·²è¢«é€‰æ‹©ï¼Œè¯·é€‰æ‹©å…¶ä»–ä¸»å…¬ï¼');
                return;
            }
            
            document.getElementById('characterSelection').style.display = 'none';
            game = new ThreeKingdomsGame(character);
            document.getElementById('gameContainer').style.display = 'grid';
        }
    </script>
</body>
</html>